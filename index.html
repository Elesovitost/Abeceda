<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>P√≠smenkov√° hra</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
	
	.topbar {
	  display: flex;
	  flex-direction: column;
	  align-items: center;
	  gap: 20px;
	  margin-bottom: 30px;
	}

	.menu {
	  display: flex;
	  gap: 20px;
	  justify-content: center;
	}

	.score-container {
	  text-align: center;
	}

	.mode-button {
	  font-size: 20px;
	  padding: 12px 20px;
	  border: none;
	  border-radius: 12px;
	  cursor: pointer;
	  transition: all 0.3s;
	  font-weight: bold;
	  box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
	}

	.mode-button.writing {
	  background-color: #ffcc70;
	  color: #4b2e00;
	}

	.mode-button.reading {
	  background-color: #a0e8af;
	  color: #004d25;
	}

	.mode-button.math {
	  background-color: #99ccff;
	  color: #002b80;
	}

	#math-task {
	  font-size: 32px;
	  margin: 20px;
	}


	.mode-button:hover {
	  transform: scale(1.05);
	  box-shadow: 4px 4px 10px rgba(0,0,0,0.3);
	}

	.framed-image {
	  border: 2px solid #333;
	  max-height: 200px;
	  margin-bottom: 20px;
	}

	.apple-group {
	  display: flex;
	  flex-wrap: wrap;
	  justify-content: center;
	  gap: 4px;
	  max-width: 150px;
	  font-size: 22px;
	  background: transparent;
	  padding: 6px;
	}

	.apple-group div {
	  width: 24px;
	  text-align: center;
	}


	.math-row {
	  display: flex;
	  justify-content: center;
	  align-items: center;
	  font-size: 48px;
	  gap: 40px;
	  margin-bottom: 10px;
	}
	.math-column {
	  display: flex;
	  flex-direction: column;
	  align-items: center;
	}


    .score-label {
      font-size: 20px;
    }
    .score {
      font-size: 20px;
    }
    .score .good { color: green; margin-right: 10px; }
    .score .bad { color: red; }

    .letter-box {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 1px solid #ccc;
      font-size: 30px;
      line-height: 40px;
      margin: 2px;
    }

    .correct { border-color: green; color: green; }
    .incorrect { border-color: red; color: red; }

    #image { max-height: 200px; margin-bottom: 20px; }
    canvas { position: fixed; top: 0; left: 0; pointer-events: none; }

	#fireworks {
	  position: fixed;
	  top: 0;
	  left: 0;
	  width: 100%;
	  height: 100%;
	  pointer-events: none;
	  z-index: 1000;
	  background: transparent;
	}


    #reading-word { font-size: 32px; margin: 20px; }
    #reading-options {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    #reading-options img {
      height: 150px;
      cursor: pointer;
      border: 2px solid #333;
      transition: filter 0.3s ease, border 0.2s;
    }
  </style>
</head>
<body>

 <div class="topbar">
<div class="menu">
  <button class="mode-button writing" onclick="startGame('writing')">‚úçÔ∏è Psan√≠</button>
  <button class="mode-button reading" onclick="startGame('reading')">üìñ ƒåten√≠</button>
  <button class="mode-button math" onclick="startGame('math')">‚ûï Poƒçty</button>
</div>

  <div class="score-container">
    <div class="score-label">Sk√≥re:</div>
    <div class="score">
      <span class="good" id="score-good">0</span>
      <span class="bad" id="score-bad">0</span>
    </div>
  </div>
</div>

<input id="mobile-input" type="text" inputmode="text" style="position: absolute; top: -100px; left: -100px; width: 1px; height: 1px; opacity: 0; border: none;" />

  <img id="image" class="framed-image" src="" alt="obr√°zek" hidden />
  <div id="letters"></div>

  <div id="reading-word"></div>
  <div id="reading-options"></div>
  <div id="math-task"></div>


  <canvas id="fireworks"></canvas>

  <!-- Zvuky -->
  <audio id="fanfare" src="fanfara.mp3"></audio>
  <audio id="sound-correct" src="correct.mp3"></audio>
  <audio id="sound-wrong" src="wrong.mp3"></audio>
  <audio id="sound-win" src="win.mp3"></audio>

  <script>
    const words = ['auto', 'autobus', 'bagr', 'baz√©n', 'bota', 'bunda', 'gepard', 'hodinky', 'holub', 'kalhoty', 'kavka', 'kolo', 'koƒçka', 'letadlo', 'motorka', 'my≈°', 'ovce', 'pes', 'raketa', 'ruka', 'slon', 'tank', 'telefon', 'tramvaj', 'triko', 'tygr', 'vidliƒçka', 'vlak', 'vodop√°d', 'zebra', '≈æidle', '≈æirafa'];
    const data = words.map(word => ({
      word: word,
      img: `${word}.jpg`
    }));

    data.forEach(item => {
      const img = new Image();
      img.onload = () => { item.img = img.src; };
      img.onerror = () => {
        const jpegImg = new Image();
        jpegImg.onload = () => { item.img = jpegImg.src; };
        jpegImg.src = `${item.word}.jpeg`;
      };
      img.src = item.img;
    });

    let writingPool = [...data];
    let readingPool = [...data];
    let currentWord = '';
    let userInput = [];
    let scoreGood = 0;
    let scoreBad = 0;
    let isLocked = false;
	let currentMode = null;
	let correctAnswer = null;
	const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);



    function updateScoreDisplay() {
      document.getElementById('score-good').textContent = scoreGood;
      document.getElementById('score-bad').textContent = scoreBad;
    }

    function playSound(id) {
      const sound = document.getElementById(id);
      if (sound) {
        sound.currentTime = 0;
        sound.play().catch(() => {});
      }
    }

function startGame(mode) {
	currentMode = mode;
  // Odpojit oba kl√°vesnicov√© re≈æimy
  document.removeEventListener('keydown', handleKey);
  document.removeEventListener('keydown', handleMathKey);

  // Vyƒçistit a skr√Ωt v≈°e
  document.getElementById('image').hidden = true;
  document.getElementById('letters').style.display = 'none';
  document.getElementById('letters').innerHTML = '';
  document.getElementById('reading-word').textContent = '';
  document.getElementById('reading-options').innerHTML = '';
  document.getElementById('math-task').innerHTML = '';

  if (mode === 'writing') {
    writingPool = [...data];
    loadRandom();
    document.getElementById('image').hidden = false;
    document.getElementById('letters').style.display = 'block';
    document.addEventListener('keydown', handleKey);
	document.getElementById('mobile-input').focus();
  } else if (mode === 'reading') {
    readingPool = [...data];
    loadReadingTask();
  } else if (mode === 'math') {
    loadMathTask();
    document.addEventListener('keydown', handleMathKey);
	document.getElementById('mobile-input').focus();
  }
}


    function loadRandom() {
      if (writingPool.length === 0) {
        alert("V≈°echna slova byla pou≈æita!");
        return;
      }
      const index = Math.floor(Math.random() * writingPool.length);
      const random = writingPool.splice(index, 1)[0];
      currentWord = random.word;
      userInput = [];
      isLocked = false;

      const img = document.getElementById('image');
      img.src = random.img;
      img.hidden = false;

      const lettersDiv = document.getElementById('letters');
      lettersDiv.innerHTML = '';

      for (let i = 0; i < currentWord.length; i++) {
        const span = document.createElement('span');
        span.className = 'letter-box';
        span.textContent = '';
        lettersDiv.appendChild(span);
      }
    }

    function handleKey(e) {
      if (isLocked) return;

      const key = e.key;
      const index = userInput.length;

      if (key.length === 1 && key.match(/[a-zA-Z√°-≈æ√Å-≈Ω]/i)) {
        if (index < currentWord.length) {
          const correctChar = currentWord[index];

          if (key.toLowerCase() === correctChar.toLowerCase()) {
            userInput.push(key);
            scoreGood++;
            playSound('sound-correct');
            updateScoreDisplay();
            updateDisplay();
          } else {
            userInput.push(key);
            scoreBad++;
            playSound('sound-wrong');
            updateScoreDisplay();
            updateDisplay();

            isLocked = true;
            setTimeout(() => {
              if (userInput[index]?.toLowerCase() !== correctChar.toLowerCase()) {
                userInput.splice(index, 1);
                updateDisplay();
              }
              isLocked = false;
            }, 1000);
          }
        }
      } else if (e.key === 'Backspace') {
        userInput.pop();
        updateDisplay();
      }
    }

    function updateDisplay() {
      const letters = document.getElementById('letters').children;

      for (let i = 0; i < currentWord.length; i++) {
        const box = letters[i];
        const inputChar = userInput[i];

        box.textContent = inputChar || '';

        if (!inputChar) {
          box.className = 'letter-box';
        } else if (inputChar.toLowerCase() === currentWord[i].toLowerCase()) {
          box.className = 'letter-box correct';
        } else {
          box.className = 'letter-box incorrect';
        }
      }

      if (
		  userInput.length === currentWord.length &&
		  userInput.join('').toLowerCase() === currentWord.toLowerCase()
		) {
		  playSound('sound-win');
		  launchFireworks();
		  isLocked = true;
		  setTimeout(() => {
			stopFireworks();
			if (currentMode === 'writing') {
			  loadRandom();
			  isLocked = false;
			}
		  }, 2000);
		}
    }

    function loadReadingTask() {
      if (readingPool.length === 0) {
        alert("V≈°echna slova byla p≈ôeƒçtena!");
        return;
      }
      const index = Math.floor(Math.random() * readingPool.length);
      const correct = readingPool.splice(index, 1)[0];
      currentWord = correct.word;

      document.getElementById('reading-word').textContent = currentWord;
      const container = document.getElementById('reading-options');
      container.innerHTML = '';

      const shuffled = [...data]
        .filter(item => item.word !== currentWord)
        .sort(() => 0.5 - Math.random())
        .slice(0, 4);

      shuffled.push(correct);
      shuffled.sort(() => 0.5 - Math.random());

      shuffled.forEach(item => {
        const img = document.createElement('img');
        img.src = item.img;
        img.alt = item.word;
        img.style.filter = '';
        img.addEventListener('mouseenter', () => img.style.border = '2px solid blue');
        img.addEventListener('mouseleave', () => img.style.border = '2px solid #333');
        img.addEventListener('click', () => handleReadingClick(img, item.word === currentWord));
        container.appendChild(img);
      });
    }

    function handleReadingClick(img, isCorrect) {
      const all = document.querySelectorAll('#reading-options img');
      all.forEach(el => el.style.pointerEvents = 'none');

      if (isCorrect) {
  img.style.filter = 'brightness(0.6) sepia(1) hue-rotate(90deg) saturate(4)';
  scoreGood++;
  updateScoreDisplay();
  playSound('sound-win');
  launchFireworks();
  setTimeout(() => {
    stopFireworks();
    if (currentMode === 'reading') {
      loadReadingTask();
    }
  }, 2000);
}
else {
  img.style.filter = 'brightness(0.5) sepia(1) hue-rotate(-50deg) saturate(5)';
  scoreBad++;
  updateScoreDisplay();
  playSound('sound-wrong');
  setTimeout(() => {
    if (currentMode === 'reading') {
      loadReadingTask();
    }
  }, 1000);
}

    }

function loadMathTask() {
let a = Math.floor(Math.random() * 9) + 2;
let b = Math.floor(Math.random() * 9) + 2;
const op = Math.random() > 0.5 ? '+' : '-';

if (op === '-' && b > a) {
  [a, b] = [b, a]; // prohod√≠me, aby v√Ωsledek nebyl z√°porn√Ω
}

correctAnswer = op === '+' ? a + b : a - b;

  userInput = [];
  isLocked = false;

  const taskDiv = document.getElementById('math-task');
  taskDiv.innerHTML = '';

  // ƒå√≠seln√° ≈ôada
  const row = document.createElement('div');
  row.className = 'math-row';

	const colA = document.createElement('div');
	colA.className = 'math-column';

	const divA = document.createElement('div');
	divA.textContent = a;
	colA.appendChild(divA);

	const applesA = document.createElement('div');
	applesA.className = 'apple-group';
	for (let i = 0; i < a; i++) {
	  const apple = document.createElement('div');
	  apple.textContent = 'üçé';
	  applesA.appendChild(apple);
	}
	colA.appendChild(applesA);


  const colOp = document.createElement('div');
  colOp.innerHTML = op;

	const colB = document.createElement('div');
	colB.className = 'math-column';

	const divB = document.createElement('div');
	divB.textContent = b;
	colB.appendChild(divB);


  const applesB = document.createElement('div');
  applesB.className = 'apple-group';
for (let i = 0; i < b; i++) {
  const apple = document.createElement('div');
  apple.textContent = 'üçé';
  applesB.appendChild(apple);
}

  colB.appendChild(applesB);

  row.appendChild(colA);
  row.appendChild(colOp);
  row.appendChild(colB);

  taskDiv.appendChild(row);

  // Ok√©nka pro v√Ωsledek
  const lettersDiv = document.createElement('div');
  lettersDiv.id = 'letters';
  lettersDiv.style.display = 'flex';
  lettersDiv.style.justifyContent = 'center';
  lettersDiv.style.marginTop = '10px';

  const length = correctAnswer.toString().length;
  for (let i = 0; i < length; i++) {
    const span = document.createElement('span');
    span.className = 'letter-box';
    span.textContent = '';
    lettersDiv.appendChild(span);
  }
  taskDiv.appendChild(lettersDiv);
}


function handleMathKey(e) {
  if (isLocked) return;
  const key = e.key;
  const index = userInput.length;

  if (key >= '0' && key <= '9') {
    if (index < correctAnswer.toString().length) {
      userInput.push(key);
      updateMathDisplay();
    }
  } else if (key === 'Backspace') {
    userInput.pop();
    updateMathDisplay();
  }

  if (userInput.join('') === correctAnswer.toString()) {
    scoreGood++;
    updateScoreDisplay();
    playSound('sound-win');
    launchFireworks();
    isLocked = true;
setTimeout(() => {
  stopFireworks();
  if (currentMode === 'math') {
    loadMathTask();
  }
}, 2000);

  } else if (userInput.length === correctAnswer.toString().length) {
  scoreBad++;
  updateScoreDisplay();
  playSound('sound-wrong');
  if (currentMode === 'math') {
    markMathIncorrect();
  }
  isLocked = true;
  setTimeout(() => {
    if (currentMode === 'math') {
      loadMathTask();
    }
  }, 1000);
}
}

function updateMathDisplay() {
  const boxes = document.querySelectorAll('#letters .letter-box');
  for (let i = 0; i < boxes.length; i++) {
    boxes[i].textContent = userInput[i] || '';
    boxes[i].className = 'letter-box';
  }
}

function markMathIncorrect() {
  const boxes = document.querySelectorAll('#letters .letter-box');
  boxes.forEach(box => {
    box.classList.add('incorrect');
  });
}



const canvas = document.getElementById('fireworks');
const ctx = canvas.getContext('2d');
let fireworks = [];
let fireworksInterval;

function launchFireworks() {
  resizeCanvas();
  fireworks = [];
  for (let i = 0; i < 5; i++) {
    fireworks.push(createFirework());
  }
  fireworksInterval = setInterval(updateFireworks, 50);

  const audio = document.getElementById('fanfare');
  if (audio) {
    audio.currentTime = 0;
    audio.play().catch(() => {});
  }
}

function stopFireworks() {
  clearInterval(fireworksInterval);
  fireworks = [];
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function createFirework() {
  const colors = ['#ff3333', '#33cc33', '#3399ff', '#ffff33', '#ff66cc', '#00ffff'];
  const x = Math.random() * canvas.width;
  const y = Math.random() * canvas.height / 2;
  const color = colors[Math.floor(Math.random() * colors.length)];
  const particles = [];

  for (let i = 0; i < 40; i++) {
    const angle = Math.random() * Math.PI * 2;
    const speed = Math.random() * 5 + 2;
    particles.push({
      x, y,
      dx: Math.cos(angle) * speed,
      dy: Math.sin(angle) * speed,
      alpha: 1,
      color
    });
  }

  return { particles };
}

function updateFireworks() {
  ctx.clearRect(0, 0, canvas.width, canvas.height); // nesma≈æe zbytek str√°nky

  fireworks.forEach(firework => {
    firework.particles.forEach(p => {
      p.x += p.dx;
      p.y += p.dy;
      p.alpha -= 0.02;
    });

    firework.particles = firework.particles.filter(p => p.alpha > 0);
  });

  fireworks = fireworks.filter(f => f.particles.length > 0);

  fireworks.forEach(firework => {
    firework.particles.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 3, 0, 2 * Math.PI);
      ctx.fillStyle = p.color;
      ctx.globalAlpha = p.alpha;
      ctx.fill();
    });
  });

  ctx.globalAlpha = 1;
}


function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

window.addEventListener('resize', resizeCanvas);


document.getElementById('mobile-input').addEventListener('input', (e) => {
  if (!isMobile) return; // t√≠m se vyhne≈° duplikaci na desktopu a s BT kl√°vesnic√≠
  const char = e.target.value;
  e.target.value = '';
  if (currentMode === 'writing') handleKey({ key: char });
  else if (currentMode === 'math') handleMathKey({ key: char });
});



  </script>
</body>
</html>
